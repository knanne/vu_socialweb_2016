<!DOCTYPE html>
<html>
  <head>
    <title>Force-Directed Layout</title>
    <script type="text/javascript" src="http://d3js.org/d3.v2.min.js?2.9.3"></script>
    <style>

    .link {
      stroke: #ECEFF1; /*ccc*/
      stroke-width: 1px;
      stroke-opacity: 1;
    }

    .node text {
      font: 10px sans-serif;
    }

    #legend svg {
      background: #ECEFF1;
    }

    .legend text {
      font: 14px sans-serif;
    }    

    </style>
  </head>
  <body>
    
    <h1>Analyzing Twitter Network</h1>

    <h3>Departments</3>
    <div id="legend"></div>

    <h3>Mutual Twitter Following</h3>
    <div id="graph"></div>
      
      <script>

      var width = 1200;
      var height = 900;

      //LEGEND
      groups = ['CIW', 'CLTL', 'CS', 'CW', 'FSW', 'KIN', 'L&S']

      var color = d3.scale.category10();

      var legend = d3.select("#legend").append("svg")
        .attr("width", 50+groups.length*100)
        .attr("height", 40);

      legend = legend.selectAll(".legend")
        .data(d3.range(groups.length))
        .enter()
        .append("g")
        .attr("class", "legend");

      legend.append("circle")
          .attr("r", 10)
          .attr("cx", d3.scale.linear().domain([-.5,groups.length-.5]).range([0,groups.length*100]))
          .attr("cy", 20)
          .style("fill", function(d,i) { return color(groups[i]); })
          .style("opacity", .8);

      legend.append("text")
          .attr("x", function(d,i) { return 60+(i*100); })
          .attr("y", 25)
          .text(function(d,i) {return groups[i]; });

      var svg = d3.select("#graph").append("svg")
          .attr("width", width)
          .attr("height", height);

      var force = d3.layout.force()
          .gravity(.5)
          .distance(100)
          .charge(-100)
          .size([width, height]);

      d3.json("d3network_data.json", function(json) {
        force
            .nodes(json.nodes)
            .links(json.links)
            .start();

        //draw network
        var link = svg.selectAll(".link")
            .data(json.links)
          .enter().append("line")
            .attr("class", "link");

        var node = svg.selectAll(".node")
            .data(json.nodes)
          .enter().append("g")
            .attr("class", "node")
            .call(force.drag);

        node.append("circle")
            .attr("r", function(d) { if (d.type == "network") { return Math.sqrt(d.size); } else { return 2; } })
            .style("fill", function(d) { if (d.type == "network") { return color(d.group); } else { return '#9E9E9E'; } })
            .style("opacity", .8);

        node.append("text")
            .attr("dx", 12)
            .attr("dy", ".35em")
            .text(function(d) { if ( d.type == "network") {return d.id;} else {return '';}; });

        force.on("tick", function() {
          link.attr("x1", function(d) { return d.source.x; })
              .attr("y1", function(d) { return d.source.y; })
              .attr("x2", function(d) { return d.target.x; })
              .attr("y2", function(d) { return d.target.y; });

          node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
        });
          
      });

      </script>

  </body>
</html>